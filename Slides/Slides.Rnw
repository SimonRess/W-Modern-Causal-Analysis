% Anleitungen: 
%   beamer-Dokumente: http://web.mit.edu/rsi/www/pdfs/beamer-tutorial.pdf
%   Sweave: https://rstudio-pubs-static.s3.amazonaws.com/188117_29a7a382c1884bd98ff54b9c7805613f.html

%Tools->Global Options-> Sweave: Weave Rnw files using: knitr
%                                Typeset LaTeX into PDF using: pdfLaTeX

\documentclass{beamer}
\mode<presentation>{\usetheme{Goettingen}}

\usepackage[utf8]{inputenc}
\usepackage[ngerman]{babel}


\author{Simon Ress}
\institute{Ruhr-Universität Bochum}
\title{Moderne Kausalanalyse}
\subtitle{Rubin Causal Model und Directed Acyclic Graphs} 
\date{31.10.2018}


<<echo=FALSE>>=
options(width=45) #Wie lang darf eine Zeile sein (FÃ¼r Zeilenumbruch wichtig!)
@

<<Set global chunk options, include=FALSE>>=
#other options: https://yihui.name/knitr/options/

knitr::opts_chunk$set(echo = F,  #Do NOT repeat code in final document
               message = F,  #Do NOT print R messages in document
               warning = F,  #Do NOT print warnings
               fig.width=10, 
               fig.height=6,
               tidy=TRUE  #Zeilenumbruch, wenn maximale LÃ¤nge Ã¼berschritten ist
               )
@


\begin{document}

\maketitle

%Inhaltsverzeichnis
\begin{frame}
\frametitle{Inhalt} 
\tableofcontents
\end{frame}

\section{Zweck einer Regression} % Wichtig für Inhaltsverzeichnis

\begin{frame}{Warum eine Regressionsanalyse durchführen?}
  \begin{itemize}
  \item Die Ausprägungen der unabhängigen Variable [D] sollen auf die Ausprägungen der abhängigen Variable [Y] zurückgeführt werden 
  \item Zusammenhang beider Variablen beschreiben (mit Hilfe von Formeln)
  \item Postulierte Hypothese(n) testen
  \end{itemize}
\end{frame}


\begin{frame}{Warum eine Regressionsanalyse durchführen}
  \begin{itemize}
    \item Die Ausprägungen von zwei Variablen (Y \& D) sind für sechs Einheiten dargestellt
    \item Mit welchem mathematischen Ausdruck können die Werte von Y auf D zurück geführt werden?
  \end{itemize}
  
<<Beispiel1, include=F>>=
D <- c(0,1,2,3,4,5,6,7,8)
Y <- D*2
@

  \begin{figure}
<<Plot1, fig=TRUE, echo=F>>=
plot(D,Y, main="Zusammenhang der Merkmale D & Y", xlim=c(0, 12), ylim=c(0, 12), pch = 16, cex = 1.3, col = "blue", xlab="D (Anzahl Bildungsjahre nach Sek.I)", ylab="Y (Politisches Interesse)")
axis(labels=NA,side=1,tck=-0.025,at=c(seq(from=0,to=12,by=1)))
axis(labels=NA,side=2,tck=-0.025,at=c(seq(from=0,to=12,by=1)))
@
    %\caption{Scatterplot}
  \end{figure}

\end{frame}


\section{Lineare Regression}

\begin{frame}{Linearer (perfekter) Zusammenhang}
  \begin{itemize}
    \item Die Variable Y ist immer doppelt so groß wie die Variable D
    \item Mathematische Formulierung: y = d * 2 (Kleinschreibung bei realisierten Werten einer Variable)
  \end{itemize}
  \begin{figure}
<<Plot2, fig=TRUE, echo=F>>=
plot(D,Y, main="Zusammenhang der Merkmale D & Y", xlim=c(0, 12), ylim=c(0, 12), pch = 16, cex = 1.3, col = "blue", xlab="D (Anzahl Bildungsjahre nach Sek.I)", ylab="Y (Politisches Interesse)")
axis(labels=NA,side=1,tck=-0.025,at=c(seq(from=0,to=12,by=1)))
axis(labels=NA,side=2,tck=-0.025,at=c(seq(from=0,to=12,by=1)))
abline(lm(Y ~ D))
@
    %\caption{Scatterplot}
  \end{figure}
\end{frame}




\subsection{Funktionsweise}

<<hh,include=F>>=
    set.seed(548)
    Einwohnerdichte <- round(rnorm(100, mean=230, sd=80),0)

    set.seed(422)
    Störche <- round(Einwohnerdichte*(-0.08) + rnorm(100, mean=32, sd=1),0)
    mean(Störche)
    
    cor(Störche,Einwohnerdichte)
    lm(Störche~Einwohnerdichte)
    
    set.seed(207)
    Geburten <- round(Einwohnerdichte*(-0.006) + rnorm(100, mean=3, sd=0.2),2)
    mean(Geburten)
    
    data <- data.frame(Geburten,Störche,Einwohnerdichte)
     
    summary(lm(Geburten~Störche))    
    summary(lm(Geburten~Störche+Einwohnerdichte)) 
@

\begin{frame}[fragile]{Datensatz}
<<boring-random9, echo=F, results='asis'>>=
library(xtable)
print(xtable(data[1:25,], caption = "Geburten, Störche und Einwohnerdichte (25 von 100 Beobachtungen)", digits = 1),size="\\tiny")
@
\end{frame}


\begin{frame}{Linearer Zusammenhang}
  \begin{itemize}
    \item Der Zusammenhang zwischen D (Störche) und Y (Geburten) ist nicht perfekt
    \item Wie kann dieser Zusammenhang beschreiben werden?
  \end{itemize}
  \begin{figure}
<<Plot3, fig=TRUE, echo=F>>=
plot(Störche,Geburten, main="Zusammenhang der Merkmale D & Y", xlim=c(0, 12), ylim=c(0, 2), pch = 16, cex = 1, col = "black", xlab="D (Anzahl der Störche)", ylab="Y (Geburten pro Frau)")
axis(labels=NA,side=1,tck=-0.025,at=c(seq(from=0,to=12,by=1)))
axis(labels=NA,side=2,tck=-0.025,at=c(seq(from=0,to=2,by=0.25)))
@
    %\caption{Scatterplot}
  \end{figure}
\end{frame}



\begin{frame}{Linearer Zusammenhang}
  \begin{itemize}
    \item Welche (lineare) mathematische Funktion beschreibt den Zusammenhang ab besten?
    \item Welches Kriterium kann zur Entscheidung herangezogen werden?
  \end{itemize}
  \begin{figure}
<<Plot4, fig=TRUE, echo=F>>=
plot(Störche,Geburten, main="Zusammenhang der Merkmale D & Y", xlim=c(0, 12), ylim=c(0, 2), pch = 16, cex = 1, col = "black", xlab="D (Anzahl der Störche)", ylab="Y (Geburten pro Frau)")
axis(labels=NA,side=1,tck=-0.025,at=c(seq(from=0,to=12,by=1)))
axis(labels=NA,side=2,tck=-0.025,at=c(seq(from=0,to=2,by=0.25)))
abline(lm(Geburten ~ Störche), col = 4)
abline(0.5,0.1, col = 1)
abline(0.7,0.05, col = 2)
abline(0.9,0.05, col = 3)
@
    %\caption{Scatterplot}
  \end{figure}
\end{frame}



\begin{frame}{Ordinary Least Squares (OLS-) Methode}
  \begin{itemize}
  \item (dt.) Methode der kleinsten Quadrate
  \item Idee: Mathematische Funktion bestimmen, welche möglichst gut den Zusammenhang der Daten beschreibt
  \item Abweichung der Datenpunkte von dem geschätzten Ergebniss: Residuen
  \item Auswahl der Funktion: Minimale Summe der quadrierten Abweichungen 
  \item Für dieses Minimierungsproblem existieren verschiedene Algorithmen
  \end{itemize}
\end{frame}









\subsection{Annahmen \& Voraussetzungen}


\begin{frame}{Voraussetzungen}
  \begin{itemize}
    \item Variable Y hat ein metrisches Skalenniveau
    \item Auch kategoriale Skalenniveaus möglich, die dann als metrisch angenommen werden
    \item Mindestvoraussetzungen: mindestens fünf Kategorien, ordinales Messniveau, Abstände zwischen Ausprägungen sind gleich groß, Kategorien als Wertintervalle
  \end{itemize}
\end{frame}


\subsection{Beispiele}


\begin{frame}{Beispiel Störche und Geburten}
  \begin{figure}
<<Plot6, fig=TRUE, echo=F>>=
plot(Störche,Geburten, main="Zusammenhang der Merkmale D & Y", xlim=c(0, 12), ylim=c(0, 2), pch = 16, cex = 1, col = "black", xlab="D (Anzahl der Störche)", ylab="Y (Geburten pro Frau)")
axis(labels=NA,side=1,tck=-0.025,at=c(seq(from=0,to=12,by=1)))
axis(labels=NA,side=2,tck=-0.025,at=c(seq(from=0,to=2,by=0.25)))
@
    %\caption{Scatterplot}
  \end{figure}
\end{frame}


\begin{frame}[fragile]{Variablen}
Für die Berechnung einer Regression kann folgender Befehl in R genutzt werden
<<Aa8, echo=T,eval=F>>=
lm(data$Geburten~data$Störche)
@
\end{frame}


\begin{frame}[fragile]{Lineare Regression}
<<Aag67, echo=F>>=
summary(lm(data$Geburten~data$Störche))
@
\end{frame}


\begin{frame}[fragile]{Lineare Regression}
<<Aag671, echo=F>>=
summary(lm(data$Geburten~data$Störche+data$Einwohnerdichte))
@
\end{frame}


<<Pfad2, include=F>>=
path <-"C:/Users/ress/sciebo/Arbeit/Lehrstuhl Eising/Lehre/18-WS/MethVergPolitik/Sitzungen/3 Statistische Methode Regression/Folien/Data/data-full.dta"
#path <-"C:/O/S/Arbeit/Lehrstuhl Eising/Lehre/18-WS/MethVergPolitik/Sitzungen/3 Statistische Methode Regression/Folien/Data/data-full.dta"
@

<<Datendatz darstellen, include=F>>=
library(foreign)
data <- read.dta(path)
data <- data[data$year==2010,]
data <- data[,c(1,2,3,10,15,45,52,53,54,58,94)]

names(data)[names(data) == 'chronicdiseases'] <- 'chronic'
@


\begin{frame}{Datensatz}
<<boring-random5, echo=F, results='asis'>>=
library(xtable)
print(xtable(data[data$ID<=10,c(1,2,5,8,9,10,11)], caption = "Gesundheitsausgaben und weitere Merkmale in OECD-Ländern", digits = 0),size="\\tiny")
@
\end{frame}


\begin{frame}[fragile]{Datensatz}
Die Werte einzelner Variablen können durch die Eingabe des Datensatzes, gefolgt von einem \dq\$\dq und dem Variablennamen abgerufen werden
<<Aaz, echo=T,eval=F>>=
data$GesAnteilGDP
@

<<Aagi, echo=F>>=
data$GesAnteilGDP
@
\end{frame}


\begin{frame}[fragile]{Variablen}
Für die Zuordnung der Werte zu dem Länder kann folgender Befehl genutzt werden
<<Aa3, echo=T,eval=F>>=
data[c("Land","GesAnteilGDP"), digits = 1]
@

<<boring-random61, echo=F, results='asis'>>=
library(xtable)
print(xtable(data[data$ID<=10,c(2,5)], digits = 1),size="\\tiny")
@
\end{frame}



\begin{frame}[fragile]{Lineare Regression}
Mit dem Befehl \dq lm()\dq kann eine lineare Regression berechnet werden. 
<<Aa, echo=T,eval=F>>=
lm(data$GesAnteilGDP~data$chronic +data$GDP)
@
\end{frame}


\begin{frame}[fragile]{Lineare Regression}
<<Aag, echo=F>>=
summary(lm(data$GesAnteilGDP~data$chronic +data$GDP))
@
\end{frame}





\section{Logistische Regression}

\begin{frame}{Logistische Regression}
  \begin{itemize}
  \item andere Bezeichnung: Logit-Modell
  \item zumeist ist die binomiale logistische Regression gemeint
  \item hierbei ist abhängige Variable dichotom (meist Ausprägungen 0 und 1)
  \item eine weitere Form ist die multinominale logistische Regression (abhängige Variable: multinominal)

  \end{itemize}
\end{frame}

\begin{frame}{Warum keine lineare Regression (wenn Y binär)?}
  \begin{itemize}
  \item Interpretation der Ergebnisse nicht sinnvoll
  \item Beispiel: Einfluss Einkommen(D) auf Wahl der Partei Die Grünen (Y)
  \item mögliches Ergebniss: y=0,001*D + 0,2
  \item Interpretation: Jeder zusätzliche Euro an Einkommen erhöht die Wahl der Partei Die Grünen um 0,001 (nicht sinnvoll!)
  \end{itemize}
\end{frame}


<<hhl,include=F>>=
    Gruene <- c(0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1)

    Einkommen <- c(200,750,3000,1500,1200,1000,1600,1800,1300,1650,4000,2800,3300,2500,1500,2600,2300,3500,4400,5500)
    
    data1 <- data.frame(Gruene,Einkommen)
     
    summary(lm(Gruene~Einkommen))    
@

\begin{frame}{Weitere Probleme einer linearen Regression}
  \begin{itemize}
    \item für dichotome Merkmale wie die Wahl der Grünen sind nur die Ausprägungen 0 \& 1 sinnvoll
    \item in diesem Beispiel also Wahl der Gründen ja (y=1) oder nein (y=0)
  \end{itemize}
  \begin{figure}
<<Plotz, fig=TRUE, echo=F>>=
plot(Einkommen, Gruene, main="Zusammenhang der Merkmale D & Y", pch = 16,cex = 1,col = "black", xlab="D (Einkommen in €)", ylab="Y (Wahl der Grünen)", ylim=c(-1, 2), xlim=c(0, 8000))    
abline(lm(Gruene ~ Einkommen), col = 4)
@
    %\caption{Scatterplot}
  \end{figure}
\end{frame}


\begin{frame}{Ziel der logistischen Regression}
  Schätzung der Eintrittswahrscheinlichkeit eines Ereignisses in Abhänigkeit verschiedener möglicher Einflussgrößen.
\end{frame}


\begin{frame}{Beispielhafte Fragestellungen für logistische Regressionen}
  \begin{itemize}
  \item erhöht das Einkommen die Wahrscheinlichkeit Die Grünen zu wählen?
  \item senkt der Schulabbruch ohne Abschluss die Wahrscheinlichkeit wählen zu gehen?
  \item haben Alleinerziehende eine höhere Wahrscheinlichkeit dauerhaft in ALGII zu verbleiben als Familien mit zwei Elternteilen?
  \end{itemize}
\end{frame}


\subsection{Funktionsweise}


\begin{frame}{Grundzüge der logistischen Regression}
  \begin{itemize}
  \item abhängige Variable (Y): Wahl der Grünen
  \item Ausprägungen: Nein (y=0) \& Ja (y=1)
  \item Wahrscheinlichkeiten: p(y=0) + p(y=1) = 1
  \item Abhängige Variable ist dichotom (meist Ausprägungen 0 und 1)
  \end{itemize}
\end{frame}


\begin{frame}{Logistische Funktion}
  \begin{figure}
    \includegraphics[scale=0.6]{Grafiken/LogReg_1.png} 
    \caption{Vergleich logitischer und linearer Funktion}
  \end{figure}
\end{frame}


\begin{frame}{Odds Ratios}
\begin{itemize}
  \item in Statistikprogrammen können verschiede Ausgabeformen für Beta-Koeffizienten eingestellt werden
  \item die umfangreichsten Interpretationsmöglichkeiten bieten Odds Ratios
  \item Odds Ratios(Chancenverhältnis): Verhältnis von Eintrittswahrscheinlichkeit zur Wahrscheinlichkeit das Ereignis nicht Eintritt für verschiedene Ausprägungen der unabhängigen Variable
  \end{itemize}
\end{frame}


\begin{frame}{Odds Ratios}
\begin{itemize}
  \item Interpretation: OR=1,2; für ein um einen Euro höheres Einkommen wird eine um durchschittlich (1,2-1=0,2) 20\% höhere Wahrscheinlichkeit der Wahl der Grünen geschätzt 
  \item Interpretation: OR=0,8; für ein um einen Euro höheres Einkommen wird eine durchschittliche Wahrscheinlichkeit der Wahl der Grünen geschätzt die 80\% der vorherigen Wahrscheinlichkeit entspricht
  \end{itemize}
\end{frame}


\subsection{Annahmen}

\begin{frame}{Annahmen \& Voraussetzungen}
  \begin{itemize}
  \item keine Multikollinearität (zwei oder mehr unabhängige Variablen korrelieren sehr stark miteinander)
  \item pro Ausprägung der abhängigen Variable mindestens ~25 Beobachtungen
  \item aussagekräftige Schätzungen ab ~100 Beobachtungen pro Gruppe
  \end{itemize}
\end{frame}

 
\end{document}